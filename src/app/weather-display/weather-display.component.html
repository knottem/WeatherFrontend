<app-loading-indicator *ngIf="!isLoaded"></app-loading-indicator>
<div class="weather" *ngIf="isLoaded">

  <div class="weather-card" (click)="toggleWeather('today')">
    <h2>Todays weather in {{weather.city.name}}</h2>
    <table class="weather-table">
      <thead >
        <tr>
          <th class="time-column">Time</th>
          <th class="temperature-column">Temperature</th>
          <th class="weather-column">Weather</th>
          <th class="precipitation-column">Precipitation</th>
        </tr>
      </thead>
      <tbody *ngIf="!showTodaysWeather">
        <tr>
          <td>{{ currentTimestamp }}</td>
          <td>{{ currentWeather.temperature }}°C</td>
          <td>{{ getWeatherConditionDescription(currentWeather.weatherCode) }}</td>
          <td>{{ currentWeather.precipitation }}</td>
        </tr>
      </tbody>
      <tbody *ngIf="showTodaysWeather" [@fadeInStagger]>
        <ng-template ngFor let-hour [ngForOf]="timestampsToday" let-i="index">
          <tr (click)="toggleDetailRow(i, $event)" *ngIf="!expandedRow[i]">
            <td>{{ hour.substring(11,16) }}</td>
            <td>{{ weather.weatherData[hour].temperature }}°C</td>
            <td>{{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}</td>
            <td>{{ weather.weatherData[hour].precipitation }}</td>
          </tr>
          <tr *ngIf="expandedRow[i]" class="detail-row" [@fadeInExpand] (@fadeInExpand.done)="onAnimationDone(i)"
            (click)="toggleDetailRow(i, $event)">
            <td colspan="4">
              <div class="detailed-info">
                <h1>Weather Information for {{ hour.substring(11,16) }}</h1>
                <div class="detail-item">
                  <strong>Temperature:</strong> {{ weather.weatherData[hour].temperature }}°C
                </div>
                <div class="detail-item">
                  <strong>Weather:</strong> {{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}
                </div>
                <div class="detail-item">
                  <strong>Precipitation:</strong> {{ weather.weatherData[hour].precipitation }}
                  {{weather.information.precipitation.substring(0,5)}}
                </div>
                <div class="detail-item">
                  <strong>Wind Speed:</strong> {{ weather.weatherData[hour].windSpeed }}
                  {{weather.information.windSpeed}}
                </div>
                <div class="detail-item">
                  <strong>Wind Direction:</strong> {{ weather.weatherData[hour].windDirection }}°
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </tbody>
    </table>
  </div>

  <br>

  <div class="weather-card" (click)="toggleWeather('tomorrow')">
    <h2>Tomorrows weather in {{weather.city.name}}</h2>
    <table class="weather-table">
      <thead>
        <tr>
          <th class="time-column">Time</th>
          <th class="temperature-column">Temperature</th>
          <th class="weather-column">Weather</th>
          <th class="precipitation-column">Precipitation</th>
        </tr>
      </thead>
      <tbody *ngIf="!showTomorrowsWeather">
        <tr>
          <td>{{ tomorrowWeather.timestamp.substring(11,16) }}</td>
          <td>{{ tomorrowWeather.temperature }}°C</td>
          <td>{{ getWeatherConditionDescription(tomorrowWeather.weatherCode) }}</td>
          <td>{{ tomorrowWeather.precipitation }}</td>
        </tr>
      </tbody>
      <tbody *ngIf="showTomorrowsWeather" [@fadeInStagger]>
        <ng-template ngFor let-hour [ngForOf]="timestampsTomorrow" let-i="index">
          <tr (click)="toggleDetailRow(i, $event)" *ngIf="!expandedRow[i]">
            <td>{{ hour.substring(11,16) }}</td>
            <td>{{ weather.weatherData[hour].temperature }}</td>
            <td>{{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}</td>
            <td>{{ weather.weatherData[hour].precipitation }}</td>
          </tr>
          <tr *ngIf="expandedRow[i]" class="detail-row" [@fadeInExpand] (@fadeInExpand.done)="onAnimationDone(i)"
            (click)="toggleDetailRow(i, $event)">
            <td colspan="4">
              <div class="detailed-info">
                <h1>Weather Information for {{ hour.substring(11,16) }}</h1>
                <div class="detail-item">
                  <strong>Temperature:</strong> {{ weather.weatherData[hour].temperature }}°C
                </div>
                <div class="detail-item">
                  <strong>Weather:</strong> {{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}
                </div>
                <div class="detail-item">
                  <strong>Precipitation:</strong> {{ weather.weatherData[hour].precipitation }}
                  {{weather.information.precipitation.substring(0,5)}}
                </div>
                <div class="detail-item">
                  <strong>Wind Speed:</strong> {{ weather.weatherData[hour].windSpeed }}
                  {{weather.information.windSpeed}}
                </div>
                <div class="detail-item">
                  <strong>Wind Direction:</strong> {{ weather.weatherData[hour].windDirection }}°
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </tbody>
    </table>
  </div>

  <br>
  <div class="weather-card" (click)="toggleWeather('dayAfterTomorrow')">
    <h2>Weather for {{dayAfterTomorrow}} in {{weather.city.name}}</h2>
    <table class="weather-table">
      <thead >
        <tr>
          <th class="time-column">Time</th>
          <th class="temperature-column">Temperature</th>
          <th class="weather-column">Weather</th>
          <th class="precipitation-column">Precipitation</th>
        </tr>
      </thead>
      <tbody *ngIf="!showDayAfterTomorrow">
        <tr>
          <td>{{ dayAfterTomorrowWeather.timestamp.substring(11,16) }}</td>
          <td>{{ dayAfterTomorrowWeather.temperature }}°C</td>
          <td>{{ getWeatherConditionDescription(dayAfterTomorrowWeather.weatherCode) }}</td>
          <td>{{ dayAfterTomorrowWeather.precipitation }}</td>
        </tr>
      </tbody>
      <tbody *ngIf="showDayAfterTomorrow" [@fadeInStagger]>
        <ng-template ngFor let-hour [ngForOf]="timestampsDayAfterTomorrow" let-i="index">
          <tr (click)="toggleDetailRow(i, $event)" *ngIf="!expandedRow[i]">
            <td>{{ hour.substring(11,16) }}</td>
            <td>{{ weather.weatherData[hour].temperature }}</td>
            <td>{{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}</td>
            <td>{{ weather.weatherData[hour].precipitation }}</td>
          </tr>
          <tr *ngIf="expandedRow[i]" class="detail-row" [@fadeInExpand] (@fadeInExpand.done)="onAnimationDone(i)"
            (click)="toggleDetailRow(i, $event)">
            <td colspan="4">
              <div class="detailed-info">
                <h1>Weather Information for {{ hour.substring(11,16) }}</h1>
                <div class="detail-item">
                  <strong>Temperature:</strong> {{ weather.weatherData[hour].temperature }}°C
                </div>
                <div class="detail-item">
                  <strong>Weather:</strong> {{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}
                </div>
                <div class="detail-item">
                  <strong>Precipitation:</strong> {{ weather.weatherData[hour].precipitation }}
                  {{weather.information.precipitation.substring(0,5)}}
                </div>
                <div class="detail-item">
                  <strong>Wind Speed:</strong> {{ weather.weatherData[hour].windSpeed }}
                  {{weather.information.windSpeed}}
                </div>
                <div class="detail-item">
                  <strong>Wind Direction:</strong> {{ weather.weatherData[hour].windDirection }}°
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </tbody>
    </table>
  </div>

  <br>

  <p>Weather data last updated at {{updatedTime}}. Sources: SMHI and Yr.</p>

</div>