<div class="weather-widget" *ngIf="isLoaded">

  <h2>Todays weather in {{location}}</h2>
  <table class="weather-table" >
    <thead (click)="toggleWeatherToday()">
      <tr>
        <th class="time-column">Time</th>
        <th class="temperature-column">Temperature</th>
        <th class="weather-column">Weather</th>
        <th class="precipitation-column">Precipitation</th>
      </tr>
    </thead>
    <tbody (click)="toggleWeatherToday()" *ngIf="!showTodaysWeather">
      <tr>
        <td>{{ currentTimestamp }}</td>
        <td>{{ currentWeather.temperature }}°C</td>
        <td>{{ getWeatherConditionDescription(currentWeather.weatherCode) }}</td>
        <td>{{ currentWeather.precipitation }}</td>
      </tr> 
    </tbody>
    <tbody *ngIf="showTodaysWeather" [@fadeInStagger]>
       <ng-template ngFor let-hour [ngForOf]="timestampsToday" let-i="index">
         <tr (click)="toggleDetailRow(i)" *ngIf="!expandedRow[i]">
           <td>{{ hour.substring(11,16) }}</td>
           <td>{{ weather.weatherData[hour].temperature }}°C</td>
           <td>{{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}</td>
           <td>{{ weather.weatherData[hour].precipitation }}</td>
         </tr>
         <tr *ngIf="expandedRow[i]" class="detail-row" [@fadeInExpand] (@fadeInExpand.done)="onAnimationDone(i)" (click)="toggleDetailRow(i)">
           <td colspan="4">
             <div class="detailed-info">
               <h3>Weather Information for {{ hour.substring(11,16) }}</h3>
               <div class="detail-item">
                 <strong>Temperature:</strong> {{ weather.weatherData[hour].temperature }}°C
               </div>
               <div class="detail-item">
                 <strong>Weather:</strong> {{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}
               </div>
               <div class="detail-item">
                 <strong>Precipitation:</strong> {{ weather.weatherData[hour].precipitation }} {{weather.information.precipitation.substring(0,5)}}
               </div>
               <div class="detail-item">
                 <strong>Wind Speed:</strong> {{ weather.weatherData[hour].windSpeed }} {{weather.information.windSpeed}}
               </div>
               <div class="detail-item">
                 <strong>Wind Direction:</strong> {{ weather.weatherData[hour].windDirection }}°
               </div>
             </div>
           </td>
         </tr>
        </ng-template>
      </tbody>
  </table>
  
  <br>

  <h2>Tomorrows weather in {{location}}</h2>
  <table class="weather-table">
    <thead (click)="toggleWeatherTomorrow()">
      <tr>
        <th class="time-column">Time</th>
        <th class="temperature-column">Temperature</th>
        <th class="weather-column">Weather</th>
        <th class="precipitation-column">Precipitation</th>
      </tr>
    </thead>
    <tbody (click)="toggleWeatherTomorrow()" *ngIf="!showTomorrowsWeather">
      <tr>
        <td>{{ timestampsTomorrow[12].substring(11,16) }}</td>
        <td>{{ weather.weatherData[timestampsTomorrow[12]].temperature }}°C</td>
        <td>{{ getWeatherConditionDescription(weather.weatherData[timestampsTomorrow[12]].weatherCode) }}</td>
        <td>{{ weather.weatherData[timestampsTomorrow[12]].precipitation }}</td>
      </tr> 
    </tbody>
    <tbody *ngIf="showTomorrowsWeather" [@fadeInStagger]>
      <ng-template ngFor let-hour [ngForOf]="timestampsTomorrow" let-i="index">
        <tr (click)="toggleDetailRow(i)" *ngIf="!expandedRow[i]">
          <td>{{ hour.substring(11,16) }}</td>
          <td>{{ weather.weatherData[hour].temperature }}</td>
          <td>{{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}</td>
          <td>{{ weather.weatherData[hour].precipitation }}</td>
        </tr>
        <tr *ngIf="expandedRow[i]" class="detail-row" [@fadeInExpand] (@fadeInExpand.done)="onAnimationDone(i)" (click)="toggleDetailRow(i)">
          <td colspan="4">
            <div class="detailed-info">
              <h3>Weather Information for {{ hour.substring(11,16) }}</h3>
              <div class="detail-item">
                <strong>Temperature:</strong> {{ weather.weatherData[hour].temperature }}°C
              </div>
              <div class="detail-item">
                <strong>Weather:</strong> {{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}
              </div>
              <div class="detail-item">
                <strong>Precipitation:</strong> {{ weather.weatherData[hour].precipitation }} {{weather.information.precipitation.substring(0,5)}}
              </div>
              <div class="detail-item">
                <strong>Wind Speed:</strong> {{ weather.weatherData[hour].windSpeed }} {{weather.information.windSpeed}}
              </div>
              <div class="detail-item">
                <strong>Wind Direction:</strong> {{ weather.weatherData[hour].windDirection }}°
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </tbody>
  </table>

  <br>

  <h2>Weather for {{dayAfterTomorrow}} in {{location}}</h2>
  <table class="weather-table">
    <thead (click)="toggleWeatherDayAfterTomorrow()">
      <tr>
        <th class="time-column">Time</th>
        <th class="temperature-column">Temperature</th>
        <th class="weather-column">Weather</th>
        <th class="precipitation-column">Precipitation</th>
      </tr>
    </thead>
    <tbody (click)="toggleWeatherDayAfterTomorrow()" *ngIf="!showDayAfterTomorrow">
      <tr>
        <td>{{ timestampsDayAfterTomorrow[12].substring(11,16) }}</td>
        <td>{{ weather.weatherData[timestampsDayAfterTomorrow[12]].temperature }}°C</td>
        <td>{{ getWeatherConditionDescription(weather.weatherData[timestampsDayAfterTomorrow[12]].weatherCode) }}</td>
        <td>{{ weather.weatherData[timestampsDayAfterTomorrow[12]].precipitation }}</td>
      </tr> 
    </tbody>
    <tbody *ngIf="showDayAfterTomorrow" [@fadeInStagger]>
      <ng-template ngFor let-hour [ngForOf]="timestampsDayAfterTomorrow" let-i="index">
        <tr (click)="toggleDetailRow(i)" *ngIf="!expandedRow[i]">
          <td>{{ hour.substring(11,16) }}</td>
          <td>{{ weather.weatherData[hour].temperature }}</td>
          <td>{{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}</td>
          <td>{{ weather.weatherData[hour].precipitation }}</td>
        </tr>
        <tr *ngIf="expandedRow[i]" class="detail-row" [@fadeInExpand] (@fadeInExpand.done)="onAnimationDone(i)" (click)="toggleDetailRow(i)">
          <td colspan="4">
            <div class="detailed-info">
              <h3>Weather Information for {{ hour.substring(11,16) }}</h3>
              <div class="detail-item">
                <strong>Temperature:</strong> {{ weather.weatherData[hour].temperature }}°C
              </div>
              <div class="detail-item">
                <strong>Weather:</strong> {{ getWeatherConditionDescription(weather.weatherData[hour].weatherCode) }}
              </div>
              <div class="detail-item">
                <strong>Precipitation:</strong> {{ weather.weatherData[hour].precipitation }} {{weather.information.precipitation.substring(0,5)}}
              </div>
              <div class="detail-item">
                <strong>Wind Speed:</strong> {{ weather.weatherData[hour].windSpeed }} {{weather.information.windSpeed}}
              </div>
              <div class="detail-item">
                <strong>Wind Direction:</strong> {{ weather.weatherData[hour].windDirection }}°
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </tbody>
  </table>

  <br>

  <p>Weather data last updated at {{updatedTime}}. Sources: SMHI and Yr.</p>

</div>